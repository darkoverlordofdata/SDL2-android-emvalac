/**
 * Entitas Generated Entity & Components for shmupwarz
 *
 * do not edit this file
 */
namespace Entitas {
	public struct Entity {			   	
											/* Core component: */  
		public int 			id;				/* sequentially assigned id# */
		public string 		name; 			/* display name */
		public int 			pool;			/* pool entities by type */
		public uint64 		mask;			/* HasComponent bit array */
		public Transform 	transform;		/* core game object */

        /**
         * Subscribe to Component Added Event
         * @type Event.EntityChanged */
		public Event.EntityChanged		onComponentAdded;

        /**
         * Subscribe to Component Removed Event
         * @type Event.EntityChanged */
		public Event.EntityChanged		onComponentRemoved;

        /**
         * Subscribe to Entity Released Event
         * @type Event.EntityReleased */
		public Event.EntityReleased		onEntityReleased;

        /**
         * Subscribe to Component Replaced Event
         * @type Event.ComponentReplaced */
		public Event.ComponentReplaced	onComponentReplaced;

		/* ============================ */
		public Background? 	background; 	/* flag */
		public Bullet? 		bullet;			/* flag */
		public Enemy1? 		enemy1;			/* flag */
		public Enemy2? 		enemy2;			/* flag */
		public Enemy3? 		enemy3;			/* flag */
		public Expires? 	expires;		/* value */
		public Health? 		health;			/* value */
		public Hud? 		hud;			/* value */
		public Layer? 		layer;			/* value */
		public Player? 		player;			/* flag */
		public Show?		show;			/* flag */
		public Sound? 		sound;			/* value */
		public Text? 		text;			/* value */
		public Tint? 		tint;			/* value */
		public Tween?		tween;			/* value */
		public Velocity? 	velocity;		/* value */
		/* ============================ */

		public Entity(int id, 
			Event.EntityChanged.Handler? ComponentAddedOrRemoved = null, 
			Event.EntityReleased.Handler? ComponentEntityReleased = null, 
			Event.ComponentReplaced.Handler? ComponentComponentReplaced = null) {

			this.id = id;

            onEntityReleased = new Event.EntityReleased();
            onComponentAdded = new Event.EntityChanged();
            onComponentRemoved = new Event.EntityChanged();
            onComponentReplaced = new Event.ComponentReplaced();

			if (ComponentEntityReleased != null)
				onEntityReleased.add(ComponentEntityReleased);
			if (ComponentAddedOrRemoved != null)
				onComponentAdded.add(ComponentAddedOrRemoved);
			if (ComponentAddedOrRemoved != null)
				onComponentRemoved.add(ComponentAddedOrRemoved);
			if (ComponentComponentReplaced != null)
				onComponentReplaced.add(ComponentComponentReplaced);
		}

        /**
         * Destroy
         *
         */
		public void dispose() {
			setActive(false);
		}

        /**
         * HasAnyComponent
         *
         * @param Array<number> indices
         * @returns boolean
         */
		public bool hasAnyComponent(int[] indices) {
			foreach (var index in indices)
				if ((POW2[index] & mask) != 0) return true;
			return false;
		}

         /**
          * HasComponent
          *
          * @param number index
          * @returns boolean
          */
		public bool hasComponent(int index) {
			return (POW2[index] & mask) != 0;
		}

        /**
         * HasComponents
         *
         * @param Array<number> indices
         * @returns boolean
         */
		public bool hasComponents(int[] indices) {
			foreach (var index in indices) 
				if ((POW2[index] & mask) == 0) return false;
			return true;
		}

		public bool isActive() {
			return (mask & ACTIVE) == ACTIVE;
		}

		public Entity* setId(int id) {
			this.id = id;
			return &this;
		}

		public Entity* setName(string name) {
			this.name = name;
			return &this;
		}

		public Entity* setActive(bool active) {
			if (((mask & ACTIVE) == ACTIVE ) == active) return &this;
			if (active) mask |= ACTIVE;
			else mask ^= ACTIVE;
			return &this;
		}

		public Entity* setBounds(int x, int y, int w, int h) {
			transform.aabb.x = x;
			transform.aabb.y = y;
			transform.aabb.w = w;
			transform.aabb.h = h;
			return &this;
		}

		public Entity* setPool(int pool) {
			this.pool = pool;
			return &this;
		}

		public Entity* setPosition(float x, float y) {
			transform.position.x = x;
			transform.position.y = y;

			if (transform.sprite.centered) {
				transform.aabb.x = (int)(x - transform.aabb.w / 2);
				transform.aabb.y = (int)(y - transform.aabb.h / 2);
			} else {
				transform.aabb.x = (int)x;
				transform.aabb.y = (int)y;
			}
			return &this;
		}

		public Entity* setScale(float x, float y) {
			transform.scale.x = x;
			transform.scale.y = y;
			return &this;
		}

		public Entity* setTransform(Sdx.Graphics.Sprite sprite) {
			transform = Transform(sprite);
			return &this;
		}
		
		public string toString() {
			var sb = new StringBuilder();
			sb.Append(id.ToString())
			.Append("(")
			.Append(name)
			.Append(")");

			for (var i = 1, seperator = false; i <= ComponentString.length; i++) {
				if (hasComponent(i)) {
					if (seperator) sb.Append(", ");
					sb.Append(ComponentString[i]);
					seperator = true;
				}
			}
			return sb.str;
		}


		public Entity* setBackground(bool value) {
			if (value) {
				background = { true };
				mask |= BACKGROUND;
				//eventHandler.OnEntityChanged(&this, Components.BackgroundComponent, &background);
				onComponentAdded.dispatch(&this, Components.BackgroundComponent, &background);
			} else {
				var prev = background;
				background = null;
				mask ^= BACKGROUND;
				onComponentRemoved.dispatch(&this, Components.BackgroundComponent, &prev);
			}
			return &this;
		}

		public bool isBackground() {
			return (mask & BACKGROUND) == BACKGROUND;
		}

		public Entity* setBullet(bool value) {
			if (value) {
				bullet = { true };
				mask |= BULLET;
				onComponentAdded.dispatch(&this, Components.BulletComponent, &bullet);
			} else {
				var prev = bullet;
				bullet = null;
				mask ^= BULLET;
				onComponentRemoved.dispatch(&this, Components.BulletComponent, &prev);
			}
			return &this;
		}

		public bool isBullet() {
			return (mask & BULLET) == BULLET;
		}

		public Entity* setEnemy1(bool value) {
			if (value) {
				enemy1 = { true };
				mask |= ENEMY1;
				onComponentAdded.dispatch(&this, Components.Enemy1Component, &enemy1);
			} else {
				var prev = enemy1;
				enemy1 = null;
				mask ^= ENEMY1;
				onComponentRemoved.dispatch(&this, Components.Enemy1Component, &prev);
			}
			return &this;
		}

		public bool isEnemy1() {
			return (mask & ENEMY1) == ENEMY1;
		}

		public Entity* setEnemy2(bool value) {
			if (value) {
				enemy2 = { true };
				mask |= ENEMY2;
				onComponentAdded.dispatch(&this, Components.Enemy2Component, &enemy2);
			} else {
				var prev = enemy2;
				enemy2 = null;
				mask ^= ENEMY2;
				onComponentRemoved.dispatch(&this, Components.Enemy2Component, &prev);
			}
			return &this;
		}

		public bool isEnemy2() {
			return (mask & ENEMY2) == ENEMY2;
		}

		public Entity* setEnemy3(bool value) {
			if (value) {
				enemy3 = { true };
				mask |= ENEMY3;
				onComponentAdded.dispatch(&this, Components.Enemy3Component, &enemy3);
			} else {
				var prev = enemy3;
				enemy3 = null;
				mask ^= ENEMY3;
				onComponentRemoved.dispatch(&this, Components.Enemy3Component, &prev);
			}
			return &this;
		}

		public bool isEnemy3() {
			return (mask & ENEMY3) == ENEMY3;
		}

		public bool hasExpires() {
			return (mask & EXPIRES) != 0;
		}

		public Entity* addExpires(float value) {
			if ((mask & EXPIRES) == EXPIRES) throw new Exception.EntityAlreadyHasComponent("Expires");
			expires = { value };
			mask |= EXPIRES;
			onComponentAdded.dispatch(&this, Components.ExpiresComponent, &expires);
			return &this;
		}

		public Entity* setExpires(float value) {
			if ((mask & EXPIRES) != EXPIRES) throw new Exception.EntityDoesNotHaveComponent("Expires");
			this.expires.value = value;
			return &this;
		}

		public Entity* removeExpires() {
			if ((mask & EXPIRES) != EXPIRES) throw new Exception.EntityDoesNotHaveComponent("Expires");
			var prev = expires;
			expires = null;
			mask ^= EXPIRES;
			onComponentRemoved.dispatch(&this, Components.ExpiresComponent, &prev);
			return &this;
		}

		public bool hasHealth() {
			return (mask & HEALTH) == HEALTH;
		}

		public Entity* addHealth(float current, float maximum) { 
			if ((mask & HEALTH) == HEALTH) throw new Exception.EntityAlreadyHasComponent("Health");
			health = { current, maximum };
			mask |= HEALTH;
			onComponentAdded.dispatch(&this, Components.HealthComponent, &health);
			return &this;
		}

		public Entity* setHealth(float current, float maximum) {
			if ((mask & HEALTH) != HEALTH) throw new Exception.EntityDoesNotHaveComponent("Health");
			this.health.current = current;
			this.health.maximum = maximum;
			return &this;
		}

		public Entity* removeHealth() {
			if ((mask & HEALTH) != HEALTH) throw new Exception.EntityDoesNotHaveComponent("Health");
			var prev = health;
			health = null;
			mask ^= HEALTH;
			onComponentRemoved.dispatch(&this, Components.HealthComponent, &prev);
			return &this;
		}

		public Entity* setHud(bool value) {
			if (value) {
				hud = { true };
				mask |= HUD;
				onComponentAdded.dispatch(&this, Components.HudComponent, &hud);
			} else {
				var prev = hud;
				hud = null;
				mask ^= HUD;
				onComponentRemoved.dispatch(&this, Components.HudComponent, &prev);
			}
			return &this;
		}

		public bool isHud() {
			return (mask & HUD) == HUD;
		}


		public bool hasLayer() {
			return (mask & LAYER) == LAYER;
		}

		public Entity* addLayer(int value) { 
			if ((mask & LAYER) == LAYER) throw new Exception.EntityAlreadyHasComponent("Layer");
			layer = { value };
			mask |= LAYER;
			onComponentAdded.dispatch(&this, Components.LayerComponent, &layer);
			return &this;
		}

		public Entity* setLayer(int value) {
			if ((mask & LAYER) != LAYER) throw new Exception.EntityDoesNotHaveComponent("Layer");
			this.layer.value = value;
			return &this;
		}

		public Entity* removeLayer() {
			if ((mask & LAYER) != LAYER) throw new Exception.EntityDoesNotHaveComponent("Layer");
			var prev = layer;
			layer = null;
			mask ^= LAYER;
			onComponentRemoved.dispatch(&this, Components.LayerComponent, &prev);
			return &this;
		}

		public Entity* setPlayer(bool value) {
			if (value) {
				player = { true };
				mask |= PLAYER;
				onComponentAdded.dispatch(&this, Components.PlayerComponent, &player);
			} else {
				var prev = player;
				player = null;
				mask ^= PLAYER;
				onComponentRemoved.dispatch(&this, Components.PlayerComponent, &prev);
			}
			return &this;
		}

		public bool isPlayer() {
			return (mask & PLAYER) == PLAYER;
		}

		public Entity* setShow(bool value) {
			if (value) {
				show = { true };
				mask |= SHOW;
				onComponentAdded.dispatch(&this, Components.ShowComponent, &show);
			} else {
				var prev = show;
				show = null;
				mask ^= SHOW;
				onComponentRemoved.dispatch(&this, Components.ShowComponent, &prev);
			}
			return &this;
		}

		public bool isShow() {
			return (mask & SHOW) == SHOW;
		}


		public bool hasSound() {
			return (mask & SOUND) == SOUND;
		}

		public Entity* addSound(Sdx.Audio.Sound sound) {
			if ((mask & SOUND) == SOUND) throw new Exception.EntityAlreadyHasComponent("Sound");
			this.sound = { sound };
			mask |= SOUND;
			onComponentAdded.dispatch(&this, Components.SoundComponent, &this.sound);
			return &this;
		}

		public Entity* setSound(Sdx.Audio.Sound sound) {
			if ((mask & SOUND) != SOUND) throw new Exception.EntityDoesNotHaveComponent("Sound");
			this.sound.sound = sound;
			return &this;
		}

		public Entity* removeSound() {
			if ((mask & SOUND) != SOUND) throw new Exception.EntityDoesNotHaveComponent("Sound");
			var prev = sound;
			sound = null;
			mask ^= SOUND;
			onComponentRemoved.dispatch(&this, Components.SoundComponent, &prev);
			return &this;
		}

		public bool hasText() {
			return (mask & TEXT) == TEXT;
		}

		public Entity* addText(string text, Sdx.Graphics.Sprite.TextSprite texture) { 
			if ((mask & TEXT) == TEXT) throw new Exception.EntityAlreadyHasComponent("Text");
			this.text = { text, texture };
			mask |= TEXT;
			onComponentAdded.dispatch(&this, Components.TextComponent, &this.text);
			return &this;
		}

		public Entity* setText(string text, Sdx.Graphics.Sprite.TextSprite texture) {
			if ((mask & TEXT) != TEXT) throw new Exception.EntityDoesNotHaveComponent("Text");
			this.text.text = text;
			this.text.sprite = texture;
			return &this;
		}

		public Entity* removeText() {
			if ((mask & TEXT) != TEXT) throw new Exception.EntityDoesNotHaveComponent("Text");
			var prev = text;
			text = null;
			mask ^= TEXT;
			onComponentRemoved.dispatch(&this, Components.TextComponent, &prev);
			return &this;
		}

		public bool hasTint() {
			return (mask & TINT) == TINT;
		}

		public Entity* addTint(int r, int g, int b, int a) {
			if ((mask & TINT) == TINT) throw new Exception.EntityAlreadyHasComponent("Tint");
			tint = { r, g, b, a };
			mask |= TINT;
			onComponentAdded.dispatch(&this, Components.TintComponent, &tint);
			return &this;
		}

		public Entity* setTint(int r, int g, int b, int a) {
			if ((mask & TINT) != TINT) throw new Exception.EntityDoesNotHaveComponent("Tint");
			this.tint.r = r;
			this.tint.g = g;
			this.tint.b = b;
			this.tint.a = a;
			return &this;
		}

		public Entity* removeTint() {
			if ((mask & TINT)!= TINT) throw new Exception.EntityDoesNotHaveComponent("Tint");
			var prev = tint;
			tint = null;
			mask ^= TINT;
			onComponentRemoved.dispatch(&this, Components.TintComponent, &prev);
			return &this;
		}

		public bool hasTween() {
			return (mask & TWEEN) == TWEEN;
		}

		public Entity* addTween(float min, float max, float speed, bool repeat, bool active) { 
			if ((mask & TWEEN) == TWEEN) throw new Exception.EntityAlreadyHasComponent("Tween");
			tween = { min, max, speed, repeat, active };
			mask |= TWEEN;
			onComponentAdded.dispatch(&this, Components.TweenComponent, &tween);
			return &this;
		}

		public Entity* setTween(float min, float max, float speed, bool repeat, bool active) {
			if ((mask & TWEEN) != TWEEN) throw new Exception.EntityDoesNotHaveComponent("Tween");
			this.tween.min = min;
			this.tween.max = max;
			this.tween.speed = speed;
			this.tween.repeat = repeat;
			this.tween.active = active;
			return &this;
		}

		public Entity* removeTween() {
			if ((mask & TWEEN) != TWEEN) throw new Exception.EntityDoesNotHaveComponent("Tween");
			var prev = tween;
			tween = null;
			mask ^= TWEEN;
			onComponentRemoved.dispatch(&this, Components.TweenComponent, &prev);
			return &this;
		}

		public bool hasVelocity() {
			return (mask & VELOCITY) == VELOCITY;
		}

		public Entity* addVelocity(float x, float y) { 
			if ((mask & VELOCITY) == VELOCITY) throw new Exception.EntityAlreadyHasComponent("Velocity");
			velocity = { x, y };
			mask |= VELOCITY;
			onComponentAdded.dispatch(&this, Components.VelocityComponent, &velocity);
			return &this;
		}

		public Entity* setVelocity(float x, float y) {
			if ((mask & VELOCITY) != VELOCITY) throw new Exception.EntityDoesNotHaveComponent("Velocity");
			this.velocity.x = x;
			this.velocity.y = y;
			return &this;
		}

		public Entity* removeVelocity() {
			if ((mask & VELOCITY) != VELOCITY) throw new Exception.EntityDoesNotHaveComponent("Velocity");
			var prev = velocity;
			velocity = null;
			mask ^= VELOCITY;
			onComponentRemoved.dispatch(&this, Components.VelocityComponent, &prev);
			return &this;
		}
	}
}
